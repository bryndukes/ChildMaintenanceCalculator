@using ChildMaintenanceCalculator.Models.ViewModels;
@using HtmlHelpers.BeginCollectionItemCore;
@model Step1ReceivingParent;

@{
    //TODO: Add null checking here
    string receivingParentIndex = ViewData["receivingParentIndex"].ToString();
    int receivingParentId = int.Parse(receivingParentIndex) + 1;
    string receivingParentHtmlId = $"ReceivingParent[{receivingParentIndex}]";
    Html.ViewData.TemplateInfo.HtmlFieldPrefix = receivingParentHtmlId;
}

@{
    using (Html.BeginCollectionItem("Step1ReceivingParents"))
    {
        <div id="@($"addReceivingParent{receivingParentId}")" class="addReceivingParentDiv">
            <h2>Receiving Parent @(receivingParentId)</h2>
            <input asp-for="Id" type="hidden" value="@receivingParentId" />

            <label>First Name</label>
            <input asp-for="FirstName" />

            <div id="@($"addChildrenList{receivingParentId}")">
                @{
                    //If the parent partial has been created by ajax request, then the new childIndex will have been passed from the controller and should be used from here
                    //If the parent partial is for the first parent, then the child index is 0
                    int childIndex = ViewData["firstChildIndex"] != null ? (int)ViewData["firstChildIndex"] : 0;
                    foreach (Step1Child child in Model.Step1Children)
                    {
                        <div>
                            <!--Give this an index ID-->
                            @await Html.PartialAsync("_AddChildPartial", child, new ViewDataDictionary(this.ViewData) { { "childIndex", childIndex } }))
                        </div>
                        childIndex++;
                    }
                }
            </div>

            <input type="button" id="@($"addChildButton{receivingParentId}")" class="addChildButton" value="+" />
        </div>
    }
}




